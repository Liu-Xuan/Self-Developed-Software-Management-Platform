# 软件管理平台框架说明

## 更新时间：2024-02-09

## 目录结构
```
.
├── app/
│   ├── __init__.py
│   ├── models.py
│   ├── routes.py
│   ├── static/
│   │   ├── css/
│   │   ├── js/
│   │   └── fonts/
│   ├── templates/
│   │   ├── base.html
│   │   ├── index.html
│   │   ├── upload.html
│   │   └── default_coc_template.json
│   └── utils/
│       └── pdf_template.py
├── instance/
│   └── software.db
├── uploads/
├── config.py
├── requirements.txt
└── run.py
```

## 主要模块说明

### 1. 数据模型 (models.py)
- Software：软件信息模型
  - 基本信息：类型、机型、厂家、名称、件号等
  - 状态信息：允装状态、实装状态
  - 更新信息：更新内容、原因、备注
- File：文件信息模型
  - 关联软件ID
  - 文件路径
  - COC文档路径

### 2. 路由处理 (routes.py)
- 首页路由：显示软件列表
- 上传路由：处理软件上传
- 下载路由：处理COC文档下载
- 状态更新路由：处理软件状态变更

### 3. PDF模板处理 (utils/pdf_template.py)
- PDFTemplate类：处理PDF生成
  - 模板加载：支持自定义和默认模板
  - 字体处理：智能检测系统字体
  - PDF生成：基于模板生成文档

### 4. 模板文件
- default_coc_template.json：默认COC模板
  - 文档布局：标题、内容、页脚
  - 字段配置：标签、位置、字体
  - 分节布局：基本信息、状态、更新说明

### 5. 静态资源
- CSS：样式文件
- JavaScript：交互脚本
- 字体：中文字体支持

## 主要功能流程

### 1. 软件上传
1. 用户填写表单
2. 验证表单数据
3. 保存软件信息
4. 生成COC文档
5. 保存文件记录

### 2. COC文档生成
1. 加载PDF模板
2. 检测系统字体
3. 填充软件信息
4. 生成PDF文档

### 3. 文档下载
1. 验证文档存在
2. 返回文档流
3. 处理下载错误

## 技术特点

### 1. 模板化设计
- JSON配置：灵活的文档模板
- 分离关注点：内容与样式分离
- 可扩展性：支持多种模板

### 2. 字体处理
- 多平台支持：Windows/macOS/Linux
- 智能检测：自动选择可用字体
- 回退机制：确保生成成功

### 3. 文件管理
- 唯一命名：避免文件冲突
- 安全处理：验证文件类型
- 错误处理：完整的异常处理

### 4. 用户界面
- 响应式设计：适配多种设备
- 交互优化：即时反馈
- 状态管理：清晰的状态显示

## 后续优化方向

### 1. 功能扩展
- 批量处理：支持批量上传和生成
- 模板管理：在线编辑模板
- 预览功能：PDF在线预览

### 2. 性能优化
- 异步处理：大文件处理
- 缓存优化：模板缓存
- 压缩优化：文件压缩

### 3. 安全性
- 访问控制：角色权限
- 数据加密：敏感信息保护
- 审计日志：操作记录 